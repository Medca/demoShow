<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>jQuery瀑布流</title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			.box{
				float: left;
				position: relative;
			}
			.content{
				padding: 10px;
				border: 1px solid #ccc;
				box-shadow: 0 0 5px #ccc;
				border-radius: 5px;
			}
			img{
				width: 190px;
				margin: auto;
			}
		</style>
	</head>
	<body>
		<div class="container" id="container">
			<div class="box">
				<div class="content">
					<img src="img/img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="content">
					<img src="img/img/10.jpg"/>
				</div>
			</div>
		</div>
		
		
		<script src="js/jquery-2.1.1.min.js"></script>
		<script type="text/javascript">
			$(function(){
				$(window).on("load",function(){
					imgLocation();
					var dataImg = {"data":[{"src":"1.jpg"},{"src":"2.jpg"},{"src":"3.jpg"},{"src":"4.jpg"},{"src":"5.jpg"}]};
        window.onscroll = function(){
            if(scrollside()){
                $.each(dataImg.data,function(index,value){
                    var box = $("<div>").addClass("box").appendTo($("#container"));
                    var content = $("<div>").addClass("content").appendTo(box);
//                    console.log("./img/img/"+$(value).attr("src"));
                    $("<img>").attr("src","./img/img/"+$(value).attr("src")).appendTo(content);
                });
                imgLocation();
            }
        };
				});
			})
			
			//滚动加载
			function scrollside(){
				var box = $(".box");
				//最后一张图片到达一半
				var lastBoxHeight = box.last().get(0).offsetTop+Math.floor(box.last().height()/2);
				//当前容器的高度
				var documentHeight = $(document).height();
				//鼠标滚动的高度
				var scrollHeight = $(window).scrollTop();
				return (lastBoxHeight<scrollHeight+documentHeight) ? true : false;
			}
			
			
			
			//瀑布流实现
			function imgLocation(){
				var box = $(".box");
				//确定图片的宽度
				var boxWidth = box.eq(0).width();
				//设置一排可以存放的图片
				var num = Math.floor($(window).width()/boxWidth);
				//存一列图片的高度
				var boxArr = [];
				box.each(function(index,value){
					//图片的高度
					var boxHeight = box.eq(index).height();
					if(index<num){
						//存放第一排的所有图片高度
						boxArr[index] = boxHeight;
						//console.log(boxHeight);
					}else{
						var minBoxHeight = Math.min.apply(null,boxArr);
						// console.log(minboxHeight);
						var minBoxIndex = $.inArray(minBoxHeight,boxArr);
						//console.log(minboxIndex);
						//console.log(value);
						$(value).css({
							"position":"absolute",
							"top":minBoxHeight,
							"left":box.eq(minBoxIndex).position().left
						});
						//重新计算图片的高度
						boxArr[minBoxIndex] += box.eq(index).height();
					}
				})
			}
		</script>
	</body>
</html>
